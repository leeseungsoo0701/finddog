<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Webpage Title -->
  <title>Home | SWEETER</title>
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon" />
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon" />
  <meta property="og:title" content="스위터 - 세상을 달달하게" />
  <meta property="og:description" content="mini project for Web Plus" />
  <meta property="og:image" content="{{ url_for('static', filename='ogimg.png') }}" />
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" />
  <!-- Font Awesome CSS -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Stylish&display=swap" rel="stylesheet" />
  <link href="{{ url_for('static', filename='mystyle.css') }}" rel="stylesheet" />

  <!-- JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
  <script src="{{ url_for('static', filename='map.js') }}"></script>
  <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=l2wmxs4eij"></script>
  <!--naver api ID-->


  <style>
    #map {
      width: 100%;
      height: 400px;
    }

    .form-control-borderless {
      border: none;
    }

    .form-control-borderless:hover,
    .form-control-borderless:active,
    .form-control-borderless:focus {
      border: none;
      outline: none;
      box-shadow: none;
    }
  </style>
  <script>
    window.onkeydown = function() {
      var kcode = event.keyCode;
      if(kcode == 116) {
      history.replaceState({}, null, location.pathname);
      
    }
      }
    //메인페이지 보여줄 시 GET APPEND(temp_html)을 이용한 모든 dog_card 보여주기
    $(document).ready(function () {
      $.ajax({
        type: "GET",
        url: '{{url_for("main_card")}}',
        data: {
        },
        success: function (response) {
          console.log(response); // 성공하면
          let main_list = response['main_card']
                    for (let i = 0; i < main_list.length; i++) {
                        let dogName = main_list[i]['dogName']
                        let dog_images = main_list[i]['dog-images']


                        let lostAddress = main_list[i]['lostAddress']
                        console.log(dogName)

                        let dog_id =main_list[i]['_id']
                        console.log(dog_id)
                        
              
                        let split_dog = dog_images.split('/')
                        let length = split_dog.length
                        console.log(length)
                        let card_img = split_dog[length-1]
                        console.log(card_img)

                        let temp_html = `   
                                            <div class="card col-12 mt-2" id="card-onclick" onclick="searchcard('${dog_id}')">
                                              <img src="static/missing/${card_img}" class="card-img-top" alt="…">
                                              <div class="card-body">
                                                <h5 class="card-title">${dogName}</h5>
                                                <p class="card-text">${lostAddress}</p>  
                                              </div>
                                            </div>
                                            `
                        $('#cards-box').append(temp_html)
                                          }

        },
      })
    });

    function alert2(){
      alert('성공입니다')
    }

    function searchcard(dog_id){    
      console.log(dog_id)  
      $.ajax({
        url:'/card_id', //request 보낼 서버의 경로
        type:'POST', // 메소드(get, post, put 등)
        data:{'dog_id':dog_id}, //보낼 데이터
        success: function(response) {
            
        },
        error: function(err) {
            
        }
    });
        }





     //네이버 MAP API 
    $(document).ready(function () {
      let map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(37.4981125, 127.0379399), // 지도의 중심 좌표
        zoom: 10, // 확대 레벨
        zoomControl: true, // 확대, 축소 아이콘 생성
        zoomControlOpions: {
          style: naver.maps.ZoomControlStyle.SMALL,
          position: naver.maps.Position.TOP_LEFT
        }
      });

      let marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(37.4981125, 127.0379399), // 마커 좌표 (이후 for문으로 여러개 출력 가능)
        map: map, // 위 설정한 'map' 이름 가져오기
        icon: "{{ url_for('static', filename='rtan_heart.png') }}" // 마커 아이콘(찾습니다, 봤어요 구분)
      });
      //     naver.maps.Event.addListener(map, 'click', function(e) {
      //     marker.setPosition(e.coord);
      // });

    })


    //강아지 이름 검색 시 POST AND GET APPEND(temp_html)
    function search_dog_name() {

      var search_dog = $('#search_dog').val()
      $.ajax({
        type: "POST",
        url: '{{url_for("search_dog")}}',
        data: {
          'search_dog': search_dog
        },
        success: function (response) {
          $('#cards-box').empty()   // 검색 시 기존의 카드 empty 후 다시 채우기 만약에 해당사항 없을 시 모든 카드 조회
          console.log(response); // 성공하면
          let search_list = response['search_list']
                    for (let i = 0; i < search_list.length; i++) {
                        let dogName = search_list[i]['dogName']
                        let dog_images = search_list[i]['dog-images']
                        let lostAddress = search_list[i]['lostAddress']
                        console.log(dogName)
                        let split_dog = dog_images.split('/')
                        let length = split_dog.length
                        console.log(length)
                        let card_img = split_dog[length-1]
                        console.log(card_img)

                        let temp_html = `   
                                            <div class="card col-12 mt-2">
                                              <img src="static/missing/${card_img}" class="card-img-top" alt="…">
                                              <div class="card-body">
                                                <h5 class="card-title">${dogName}</h5>
                                                <p class="card-text">${lostAddress}</p>  
                                              </div>
                                            `
                        $('#cards-box').append(temp_html)
                                          }

        },
      })
    }


</script>
</head>

<body>
  {% extends 'layout.html' %} {% block content %}

  <section class="section">
    <div class="media-content">
      <div class="field">
        <p class="control">
          <!-- 검색창 -->
        <div class="container">
          <br />
          <div class="row justify-content-center">
            <div class="col-10 col-md-10 col-lg-9">
              <form class="card card-sm">
                <div class="card-body row no-gutters align-items-center">
                  <div class="col-auto">
                    <i class="fas fa-search h4 text-body"></i>
                  </div>
                  <!-- 검색창 id : search_dog -->
                  <div class="col">
                    <input class="form-control form-control-lg form-control-borderless" type="search"
                      placeholder="강아지 이름 검색" id="search_dog" >
                  </div>
                  <!-- 검색 버튼 id : search_btn -->
                  <div class="col-auto">
                    <button class="btn btn-lg btn-warning" type="button" id="search_btn" onclick="search_dog_name()">
                      Search
                    </button>
                  </div>
                  <!--end of col-->
                </div>
              </form>
            </div>
            <!--end of col-->
          </div>
        </div>
        </p>
      </div>
    </div>
    <div id= "cards-box"></div>
    <div id="map"></div>
  </section>
  {% endblock %}

</body>

</html>